name: ðŸ” Basic Code Checks

on:
  push:
    branches: [ master, develop ]
  pull_request:
    branches: [ master, develop ]

jobs:
  basic-checks:
    name: âœ… Basic Checks
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ” Check file structure
        run: |
          echo "=== Checking project structure ==="
          echo "âœ… Source files: $(find src/ -name "*.pas" | wc -l)"
          echo "âœ… Test files: $(find tests/ -name "*.pas" | wc -l)"
          echo "âœ… Documentation: $(find . -name "*.md" | wc -l)"

      - name: ðŸ“‹ Check required files
        run: |
          echo "=== Checking required files ==="
          REQUIRED_FILES=(
            "README.md"
            "CLAUDE.md"
            "src/fafafa.ssl.abstract.intf.pas"
            "src/fafafa.ssl.factory.pas"
          )
          
          for file in "${REQUIRED_FILES[@]}"; do
            if [[ -f "$file" ]]; then
              echo "âœ… $file"
            else
              echo "âŒ Missing: $file"
              exit 1
            fi
          done

      - name: ðŸ” Check Pascal syntax (basic)
        run: |
          echo "=== Basic Pascal syntax check ==="
          # æ£€æŸ¥æ˜¯å¦æœ‰æ˜Žæ˜¾çš„è¯­æ³•é”™è¯¯
          echo "âœ… Checking for critical syntax patterns..."
          # æ£€æŸ¥å•å…ƒå£°æ˜Ž
          if grep -r "^unit " src/ | head -1 > /dev/null; then
            echo "âœ… Pascal unit declarations found"
          fi
          # æ£€æŸ¥æŽ¥å£å’Œå®žçŽ°
          if grep -r "interface\|implementation" src/ | head -1 > /dev/null; then
            echo "âœ… Interface/Implementation sections found"
          fi

      - name: ðŸ“Š Generate report
        run: |
          echo "## ðŸ” fafafa.ssl Basic Code Check Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Date**: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### âœ… File Structure" >> $GITHUB_STEP_SUMMARY
          echo "- Source files: $(find src/ -name "*.pas" | wc -l)" >> $GITHUB_STEP_SUMMARY
          echo "- Test files: $(find tests/ -name "*.pas" | wc -l)" >> $GITHUB_STEP_SUMMARY
          echo "- Documentation: $(find . -name "*.md" | wc -l)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸŽ¯ Status" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Project structure valid" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Required files present" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Basic syntax check passed" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Note**: Full compilation requires FPC environment" >> $GITHUB_STEP_SUMMARY
          echo "See [Basic CI Guide](./BASIC_CI_GUIDE.md) for setup instructions" >> $GITHUB_STEP_SUMMARY
