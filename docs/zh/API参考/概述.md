# fafafa.ssl API参考 - 概述

## 核心架构

fafafa.ssl采用分层架构，提供从低层到高层的多个抽象级别：

```
┌─────────────────────────────────────┐
│  高层API（最简单）                     │
│  TSimpleHTTPSClient                  │
│  TCertificateManager                 │
│  TLogger                             │
└──────────────┬──────────────────────┘
               │
┌──────────────┴──────────────────────┐
│  中层API（标准接口）                  │
│  ISSLContext                         │
│  ISSLConnection                      │
│  ISSLCertificate                     │
└──────────────┬──────────────────────┘
               │
┌──────────────┴──────────────────────┐
│  底层实现                            │
│  OpenSSL / WinSSL                    │
└─────────────────────────────────────┘
```

---

## 快速导航

### 高层API（推荐初学者）
- [TSimpleHTTPSClient](SimpleHTTPSClient.md) - 一行代码实现HTTPS请求
- [TCertificateManager](CertificateManager.md) - 简化证书操作
- [TLogger](Logger.md) - 生产级日志系统

### 核心接口
- [TSSLFactory](TSSLFactory.md) - SSL/TLS工厂类
- [ISSLContext](ISSLContext.md) - SSL上下文接口
- [ISSLConnection](ISSLConnection.md) - SSL连接接口
- [ISSLCertificate](ISSLCertificate.md) - 证书接口

### 类型和常量
- [基础类型](基础类型.md) - 枚举、记录等
- [错误处理](错误处理.md) - 异常类型和错误码

---

## 使用建议

### 场景1：快速HTTPS请求（最简单）

```pascal
uses
  fafafa.ssl.http.simple;

var
  LResponse: string;
begin
  LResponse := TSimpleHTTPSClient.Get('https://api.example.com/data');
end;
```

**适合**: API调用、简单爬虫、文件下载

**查看**: [TSimpleHTTPSClient](SimpleHTTPSClient.md)

---

### 场景2：标准HTTPS通信

```pascal
uses
  fafafa.ssl, fafafa.ssl.base;

var
  LContext: ISSLContext;
  LConnection: ISSLConnection;
begin
  LContext := TSSLFactory.CreateContext(sslOpenSSL, sslCtxClient);
  LConnection := LContext.CreateConnection;
  LConnection.Connect('example.com', 443);
  // 使用连接...
end;
```

**适合**: 需要精确控制、长连接、特殊配置

**查看**: [ISSLContext](ISSLContext.md), [ISSLConnection](ISSLConnection.md)

---

### 场景3：证书管理

```pascal
uses
  fafafa.ssl.cert.manager;

begin
  TCertificateManager.QuickGenerateSelfSigned(
    'localhost', 'server.pem', 'server.key');
end;
```

**适合**: 生成证书、验证证书、查看证书信息

**查看**: [TCertificateManager](CertificateManager.md)

---

## API层次说明

### 高层API（High-Level）
**特点**: 
- 一行代码完成任务
- 自动处理细节
- 适合快速开发

**类**: TSimpleHTTPSClient, TCertificateManager, TLogger

### 中层API（Mid-Level）
**特点**:
- 标准接口
- 灵活配置
- 完整控制

**接口**: ISSLContext, ISSLConnection, ISSLCertificate

### 底层API（Low-Level）
**特点**:
- 直接访问后端
- 最大灵活性
- 需要深入理解

**不推荐直接使用**

---

## 命名约定

### 类型前缀
- `T` - 类（TSSLFactory, TLogger）
- `I` - 接口（ISSLContext, ISSLConnection）
- `E` - 异常（ESSLException）

### 枚举前缀
- `ssl` - SSL相关（sslOpenSSL, sslProtocolTLS13）
- `ll` - 日志级别（llDebug, llInfo）
- `http` - HTTP方法（httpGET, httpPOST）

### 变量前缀（推荐）
- `L` - 局部变量（LContext, LConnection）
- `A` - 参数（AValue, AName）
- `F` - 私有字段（FConnection, FTimeout）

---

## 错误处理

所有API都使用异常机制报告错误：

```pascal
try
  LResponse := TSimpleHTTPSClient.Get('https://example.com');
except
  on E: ESSLException do
    WriteLn('SSL错误: ', E.Message);
  on E: EHTTPSClientException do
    WriteLn('HTTP错误: ', E.Message, ' 状态码:', E.StatusCode);
  on E: Exception do
    WriteLn('一般错误: ', E.Message);
end;
```

**查看**: [错误处理](错误处理.md)

---

## 内存管理

### 接口自动管理（推荐）

```pascal
var
  LConnection: ISSLConnection;  // 接口类型
begin
  LConnection := LContext.CreateConnection;
  // 自动释放，无需Free
end;
```

### 类手动管理

```pascal
var
  LLogger: TLogger;  // 类类型
begin
  LLogger := TLogger.Create('app.log');
  try
    LLogger.Info('消息');
  finally
    LLogger.Free;  // 必须手动释放
  end;
end;
```

---

## 线程安全

### 线程安全的类
- ✅ TLogger - 完全线程安全
- ✅ TSSLFactory - 工厂方法线程安全

### 需要注意的类
- ⚠️ ISSLContext - 可多线程共享（会话复用）
- ⚠️ ISSLConnection - 不应多线程共享（每个线程独立）
- ⚠️ TSimpleHTTPSClient - 类方法，线程安全

---

## 性能提示

### 1. 复用Context（会话复用）

```pascal
// 好：复用Context
LContext := TSSLFactory.CreateContext(sslOpenSSL, sslCtxClient);
for i := 1 to 100 do
begin
  LConnection := LContext.CreateConnection;  // 会话复用
  // 使用连接...
end;

// 差：每次创建新Context
for i := 1 to 100 do
begin
  LContext := TSSLFactory.CreateContext(sslOpenSSL, sslCtxClient);
  LConnection := LContext.CreateConnection;
  // 使用连接...
end;
```

### 2. 合适的缓冲区大小

```pascal
const
  SMALL_BUFFER = 4096;    // 4KB - 小数据
  MEDIUM_BUFFER = 16384;  // 16KB - 一般用途
  LARGE_BUFFER = 65536;   // 64KB - 大文件传输
```

### 3. 避免不必要的验证

```pascal
// 开发环境：可以禁用
LContext.SetVerifyMode([sslVerifyNone]);

// 生产环境：必须启用
LContext.SetVerifyMode([sslVerifyPeer]);
```

---

## 版本兼容性

| 功能 | 最低版本 | 推荐版本 |
|------|----------|----------|
| 核心SSL/TLS | v1.0 | v1.0+ |
| TSimpleHTTPSClient | v1.0 | v1.0+ |
| TCertificateManager | v1.0 | v1.0+ |
| TLogger | v1.0 | v1.0+ |

---

## 下一步

- **初学者**: 从[TSimpleHTTPSClient](SimpleHTTPSClient.md)开始
- **进阶用户**: 查看[ISSLContext](ISSLContext.md)和[ISSLConnection](ISSLConnection.md)
- **系统开发**: 了解[错误处理](错误处理.md)和[基础类型](基础类型.md)

---

**返回**: [快速入门](../快速入门.md) | **主页**: [README](../../../README.md)


